@inject NavigationManager NavManager
@using BlazorApp1.Models
@using BlazorApp1.HeroUI.Enum

<div class="@GetSideNavClass() bg-white/30 dark:bg-black/30">
    <div class="flex items-center justify-between p-4">
        <a href="/" class="flex items-center gap-2 font-bold text-sky-600 dark:text-sky-500 ml-5">
            <svg fill="none" height="24" viewBox="0 0 32 32" width="24" class="text-sky-600 dark:text-sky-500 scale-[2]">
                <path clip-rule="evenodd"
                      d="M17.6482 10.1305L15.8785 7.02583L7.02979 22.5499H10.5278L17.6482 10.1305ZM19.8798 14.0457L18.11 17.1983L19.394 19.4511H16.8453L15.1056 22.5499H24.7272L19.8798 14.0457Z"
                      fill="currentColor" fill-rule="evenodd" />
            </svg>
            @Configs.ApplicationName
        </a>

        <HButton OnClick="ToggleMenu" ClassName="rounded-md hover:bg-zinc-700/40 lg:hidden md:hidden" Variant="HVariant.Light" IsIconOnly="true">
            <HIcon Name="X"/>
        </HButton>
    </div>

    <nav class="flex flex-col h-full p-4 text-zinc-800 z-41 dark:text-zinc-200 text-[15px]">
        <div class="flex-1 space-y-1 overflow-y-auto">
            @foreach (var route in Configs.RouteList)
            {
                <NavLink href="@route.Href" Match="NavLinkMatch.All"
                         class="flex items-center px-3 py-2 rounded-xl font-medium transition-colors hover:bg-gray-300/50 dark:hover:bg-zinc-700/50"
                         ActiveClass="text-sky-600 dark:text-sky-500 bg-zinc-200/40 dark:bg-zinc-700/40">
                    <HIcon Name="@route.Icon" ClassName="mr-2" />
                    @route.Name
                </NavLink>
            }
        </div>
    </nav>
</div>

@if (IsOpen)
{
    <div class="fixed inset-0 dark:bg-black/30 bg-white/30 backdrop-blur-md z-41 lg:hidden md:hidden" @onclick="ToggleMenu"></div>
}

<div class="fixed bottom-0 left-0 right-0 bg-white dark:bg-zinc-900 border-t dark:border-zinc-700 z-20 lg:hidden md:hidden">
    <div class="flex justify-around">
        @foreach (var route in Configs.RouteList)
        {
            <NavLink 
                href="@route.Href" 
                Match="NavLinkMatch.All"
                class="flex flex-col items-center justify-center flex-1 py-2 px-1 text-sm transition-colors"
                ActiveClass="text-sky-600 dark:text-sky-500">
                
                <HIcon Name="@route.Icon" ClassName="text-lg mb-1" />
                <span>@route.Name</span>
            </NavLink>
        }
    </div>
</div>

@code {
    private bool IsOpen { get; set; }

    protected override void OnInitialized()
    {
        NavManager.LocationChanged += (s, e) => 
        {
            if (IsOpen) ToggleMenu();
        };
    }

    public void ToggleMenu()
    {
        IsOpen = !IsOpen;
        StateHasChanged();
    }

    private string GetSideNavClass()
    {
        var baseClasses = "fixed left-0 top-0 z-30 h-screen w-64 border-r dark:border-zinc-700 dark:bg-zinc-900/80 backdrop-blur-md transform transition-all duration-300 ease-in-out";
        return IsOpen 
            ? $"{baseClasses} translate-x-0" 
            : $"{baseClasses} -translate-x-full lg:translate-x-0 md:translate-x-0";
    }
}